webpackJsonp([17],{"3yaV":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("woOf"),l=a.n(r),o=a("Xxa5"),n=a.n(o),i=a("exGp"),s=a.n(i),u=a("JA1M"),c=function(t){return u.a.get("/sysm/quartzMgr/querySysQuartz",{params:t})},d=function(){return u.a.get("/sysm/quartzMgr/getJobClass")},m=function(t){return u.a.post("/sysm/quartzMgr/saveSysQuartz",t)},p=function(t){return u.a.delete("/sysm/quartzMgr/delSysQuartz/"+t)},f=function(t){return u.a.put("/sysm/quartzMgr/resumeSysQuartz/"+t)},b=function(t){return u.a.put("/sysm/quartzMgr/pauseSysQuartz/"+t)},z=function(t){return u.a.get("/sysm/quartzMgr/getSysQuartzJobInfo",{params:t})},h={props:{initData:{type:Object},readonly:{type:Boolean,default:!1}},inject:["jobClass"],data:function(){return{loading:!1,formData:l()({},this.initData),quartzJob:null,formRules:{quartzName:[{required:!0,message:"请输入任务名称",trigger:"change"}],quartzGroup:[{required:!0,message:"请输入任务组",trigger:"change"}],quartzClass:[{required:!0,message:"请选择执行类",trigger:"change"}],quartzCron:[{required:!0,message:"请输入Cron表达式",trigger:"change"}],quartzPriority:[{type:"number",message:"请输入数值",trigger:"change"}]}}},mounted:function(){this.formData.uuid&&this.getQuartzJobInfo()},methods:{getQuartzJobInfo:function(){var t=this;return s()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({uuid:t.formData.uuid});case 2:a=e.sent,t.quartzJob=a.data;case 4:case"end":return e.stop()}},e,t)}))()},handleUpdateData:function(){var t=this;return s()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$refs.editForm.validate();case 3:t.$emit("updataData",t.formData),t.$emit("close"),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}},e,t,[[0,7]])}))()}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("flex-container",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"elemeur-loading-text":"正在读取数据..."}},[a("el-form",{ref:"editForm",staticClass:"form-style-line",attrs:{model:t.formData,rules:t.formRules,"label-position":"right","label-width":"100px"}},[a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"quartzName"}},[a("el-input",{attrs:{maxlength:"40","show-word-limit":"",disabled:t.readonly},model:{value:t.formData.quartzName,callback:function(e){t.$set(t.formData,"quartzName",e)},expression:"formData.quartzName"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"任务组",prop:"quartzGroup"}},[a("el-input",{attrs:{maxlength:"40","show-word-limit":"",disabled:t.readonly},model:{value:t.formData.quartzGroup,callback:function(e){t.$set(t.formData,"quartzGroup",e)},expression:"formData.quartzGroup"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"执行类",prop:"quartzClass"}},[a("el-select",{attrs:{disabled:t.readonly},model:{value:t.formData.quartzClass,callback:function(e){t.$set(t.formData,"quartzClass",e)},expression:"formData.quartzClass"}},t._l(t.jobClass,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})}))],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"Cron表达式",prop:"quartzCron"}},[a("cron-tab",{attrs:{disabled:t.readonly},model:{value:t.formData.quartzCron,callback:function(e){t.$set(t.formData,"quartzCron",e)},expression:"formData.quartzCron"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"初始参数",prop:"quartzParams"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":"",disabled:t.readonly},model:{value:t.formData.quartzParams,callback:function(e){t.$set(t.formData,"quartzParams",e)},expression:"formData.quartzParams"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"执行策略",prop:"quartzMisfire"}},[a("dict-select",{attrs:{"dict-key":"QuartzMisfire",placeholder:"请选择",clearable:"",disabled:t.readonly},model:{value:t.formData.quartzMisfire,callback:function(e){t.$set(t.formData,"quartzMisfire",e)},expression:"formData.quartzMisfire"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"优先级",prop:"quartzPriority"}},[a("el-input",{attrs:{maxlength:"2","show-word-limit":"",disabled:t.readonly},model:{value:t.formData.quartzPriority,callback:function(e){t.$set(t.formData,"quartzPriority",t._n(e))},expression:"formData.quartzPriority"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"任务描述",prop:"quartzDesc"}},[a("el-input",{attrs:{type:"textarea",maxlength:"512","show-word-limit":"",disabled:t.readonly},model:{value:t.formData.quartzDesc,callback:function(e){t.$set(t.formData,"quartzDesc",e)},expression:"formData.quartzDesc"}})],1)],1),t._v(" "),t.readonly?t._e():a("el-col",[a("el-form-item",{attrs:{label:"立即执行",prop:"isRun"}},[a("el-radio-group",{attrs:{disabled:t.readonly},model:{value:t.formData.isRun,callback:function(e){t.$set(t.formData,"isRun",e)},expression:"formData.isRun"}},[a("el-radio",{attrs:{label:!0}},[t._v("是")]),t._v(" "),a("el-radio",{attrs:{label:!1}},[t._v("否")])],1)],1)],1),t._v(" "),t.formData.quartzExce?a("el-col",[a("el-form-item",{attrs:{label:"异常信息",prop:"quartzExce"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:6},readonly:"",value:t.formData.quartzExce}})],1)],1):t._e(),t._v(" "),null!==t.quartzJob?[a("el-col",[a("el-form-item",{attrs:{label:"下次执行",prop:"nextFireTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.quartzJob.nextFireTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"上次执行",prop:"prevFireTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.quartzJob.prevFireTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"生效时间",prop:"startTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.quartzJob.startTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"失效时间",prop:"endTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.quartzJob.endTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1)]:t._e(),t._v(" "),t.formData.createdUser?[a("el-col",[a("el-form-item",{attrs:{label:"创建用户 :",prop:"createdUser"}},[a("el-input",{attrs:{disabled:""},model:{value:t.formData.createdUser,callback:function(e){t.$set(t.formData,"createdUser",e)},expression:"formData.createdUser"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"创建时间 :",prop:"createdTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.formData.createdTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"更新用户 :",prop:"updatedUser"}},[a("el-input",{attrs:{disabled:""},model:{value:t.formData.updatedUser,callback:function(e){t.$set(t.formData,"updatedUser",e)},expression:"formData.updatedUser"}})],1)],1),t._v(" "),a("el-col",[a("el-form-item",{attrs:{label:"更新时间 :",prop:"updatedTime"}},[a("el-input",{attrs:{value:t.$utils.toDateString(t.formData.updatedTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1)]:t._e()],2)],1),t._v(" "),a("flex-container",{staticClass:"footer",attrs:{justifyContent:"flex-end"}},[a("el-button",{on:{click:function(e){t.$emit("close")}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleUpdateData}},[t._v("确 定")])],1)],1)},staticRenderFns:[]},q={uuid:null,quartzName:"",quartzGroup:"",quartzStat:"",quartzClass:"",quartzCron:"",quartzExce:"",quartzDesc:"",quartzParams:"",quartzMisfire:"1",quartzPriority:0,isRun:!1,createdUser:"",createdTime:"",updatedUser:"",updatedTime:""},y={components:{QuartzMgrEdit:a("VU/8")(h,v,!1,null,null,null).exports},provide:function(){return{jobClass:this.jobClass}},data:function(){return{quartzEditReadonly:!1,showQuartzDia:!1,quartzForm:{quartzName:null,quartzGroup:null,quartzStat:null},tableMultipleSelection:[],editQuartz:{},jobClass:[]}},mounted:function(){this.loadJobClass()},methods:{loadJobClass:function(){var t=this;return s()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d();case 3:a=e.sent,t.$utils.clear(t.jobClass),a.data.forEach(function(e){return t.jobClass.push(e)}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}},e,t,[[0,8]])}))()},loadQuartz:function(t){return c(t)},handleQueryQuartz:function(){this.$refs.quartzTable.loadData(this.quartzForm)},handleAddQuartz:function(){this.editQuartz=l()({},q),this.quartzEditReadonly=!1,this.showQuartzDia=!0},handleEditQuartz:function(t){this.editQuartz=l()({},q,t),this.quartzEditReadonly=!1,this.showQuartzDia=!0},handleViewJob:function(t){this.editQuartz=l()({},q,t),this.quartzEditReadonly=!0,this.showQuartzDia=!0},handleSelectionChange:function(t){var e=[];t.forEach(function(t){e.push(t.uuid)}),this.tableMultipleSelection=e},handleResumeJob:function(t){var e=this;return s()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,f([t.uuid]);case 3:a.next=7;break;case 5:a.prev=5,a.t0=a.catch(0);case 7:return a.prev=7,e.handleQueryQuartz(),a.finish(7);case 10:case"end":return a.stop()}},a,e,[[0,5,7,10]])}))()},handleResumeJobs:function(){var t=this;return s()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t.tableMultipleSelection.length>0)){e.next=4;break}return e.next=4,f(t.tableMultipleSelection);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:return e.prev=8,t.handleQueryQuartz(),e.finish(8);case 11:case"end":return e.stop()}},e,t,[[0,6,8,11]])}))()},handlePauseJob:function(t){var e=this;return s()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,b([t.uuid]);case 3:a.next=7;break;case 5:a.prev=5,a.t0=a.catch(0);case 7:return a.prev=7,e.handleQueryQuartz(),a.finish(7);case 10:case"end":return a.stop()}},a,e,[[0,5,7,10]])}))()},handlePauseJobs:function(){var t=this;return s()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t.tableMultipleSelection.length>0)){e.next=4;break}return e.next=4,b(t.tableMultipleSelection);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:return e.prev=8,t.handleQueryQuartz(),e.finish(8);case 11:case"end":return e.stop()}},e,t,[[0,6,8,11]])}))()},handleDelJob:function(t){var e=this;return s()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,p([t.uuid]);case 3:a.next=8;break;case 5:a.prev=5,a.t0=a.catch(0),console.log(a.t0);case 8:return a.prev=8,e.handleQueryQuartz(),a.finish(8);case 11:case"end":return a.stop()}},a,e,[[0,5,8,11]])}))()},handleDelJobs:function(){var t=this;return s()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t.tableMultipleSelection.length>0)){e.next=4;break}return e.next=4,p(t.tableMultipleSelection);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:return e.prev=8,t.handleQueryQuartz(),e.finish(8);case 11:case"end":return e.stop()}},e,t,[[0,6,8,11]])}))()},doUpdataQuartz:function(t){var e=this;return s()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,m(t);case 3:return a.prev=3,e.handleQueryQuartz(),a.finish(3);case 6:case"end":return a.stop()}},a,e,[[0,,3,6]])}))()}}},x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("flex-container",[a("flex-item",{attrs:{grow:1,width:"100%"}},[a("el-card",[a("flex-container",{attrs:{slot:"header",justifyContent:"space-between"},slot:"header"},[a("flex-item",{attrs:{alignItems:"center"}},[a("i",{staticClass:"el-icon-alarm-clock margin-right-6 font-size-16"}),t._v("任务管理\n        ")]),t._v(" "),a("flex-item",{attrs:{alignItems:"center"}},[a("el-button",{attrs:{type:"primary",size:"mini",circle:"",icon:"el-icon-plus",title:"添加"},on:{click:t.handleAddQuartz}}),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",circle:"",icon:"el-icon-search",title:"查询"},on:{click:t.handleQueryQuartz}}),t._v(" "),a("el-button",{attrs:{size:"mini",circle:"",plain:"",icon:"el-icon-refresh-left",title:"重置"},on:{click:function(e){t.$refs.quartzForm.resetFields()}}}),t._v(" "),a("el-button",{attrs:{size:"mini",circle:"",plain:"",icon:"el-icon-video-play",disabled:!t.tableMultipleSelection.length>0,title:"批量启用"},on:{click:t.handleResumeJobs}}),t._v(" "),a("el-button",{attrs:{size:"mini",circle:"",plain:"",icon:"el-icon-video-pause",disabled:!t.tableMultipleSelection.length>0,title:"批量暂停"},on:{click:t.handlePauseJobs}}),t._v(" "),a("el-button",{attrs:{size:"mini",circle:"",plain:"",icon:"el-icon-delete",disabled:!t.tableMultipleSelection.length>0,title:"批量删除"},on:{click:t.handleDelJobs}})],1)],1),t._v(" "),a("flex-container",{attrs:{direction:"column",wrap:"nowrap"}},[a("flex-item",{staticClass:"margin-bottom-10"},[a("el-form",{ref:"quartzForm",staticClass:"form-style-line",attrs:{model:t.quartzForm,"label-position":"right","label-width":"80px"}},[a("el-row",[a("col-pr",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[a("el-form-item",{attrs:{label:"任务名称",prop:"quartzName"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:t.quartzForm.quartzName,callback:function(e){t.$set(t.quartzForm,"quartzName",e)},expression:"quartzForm.quartzName"}})],1)],1),t._v(" "),a("col-pr",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[a("el-form-item",{attrs:{label:"任务组",prop:"quartzGroup"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:t.quartzForm.quartzGroup,callback:function(e){t.$set(t.quartzForm,"quartzGroup",e)},expression:"quartzForm.quartzGroup"}})],1)],1),t._v(" "),a("col-pr",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[a("el-form-item",{attrs:{label:"执行状态",prop:"quartzStat"}},[a("dict-select",{attrs:{"dict-key":"QuartzRunStat",placeholder:"请选择",clearable:""},model:{value:t.quartzForm.quartzStat,callback:function(e){t.$set(t.quartzForm,"quartzStat",e)},expression:"quartzForm.quartzStat"}})],1)],1)],1)],1)],1),t._v(" "),a("flex-item",[a("data-table",{ref:"quartzTable",attrs:{border:"",index:"","auto-load":"","highlight-current-row":"","auto-update":"","column-button":"","csv-button":"",title:"Data Table","load-data-func":t.loadQuartz},on:{"selection-change":t.handleSelectionChange}},[a("data-table-column",{attrs:{prop:"selection",type:"selection",align:"center",width:"50",fixed:"left"}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzName",label:"任务名称","show-overflow-tooltip":""}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzGroup",label:"任务组","show-overflow-tooltip":""}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzStat",label:"执行状态","show-overflow-tooltip":"",formatter:function(e){return t.$utils.tableColDictFormt("QuartzRunStat",e.quartzStat)}}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzClass",label:"执行类路径","show-overflow-tooltip":""}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzCron",label:"Cron表达式",width:"90",align:"center"}}),t._v(" "),a("data-table-column",{attrs:{prop:"quartzDesc",label:"任务描述","show-overflow-tooltip":""}}),t._v(" "),a("data-table-column",{attrs:{prop:"op",label:"操作",fixed:"right",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",disabled:"1"===e.row.quartzStat,icon:"el-icon-edit",title:"编辑"},on:{click:function(a){t.handleEditQuartz(e.row)}}}),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"1"===e.row.quartzStat,icon:"el-icon-delete",title:"删除"},on:{click:function(a){t.handleDelJob(e.row)}}}),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"1"===e.row.quartzStat,icon:"el-icon-video-play",title:"启用"},on:{click:function(a){t.handleResumeJob(e.row)}}}),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"2"===e.row.quartzStat,icon:"el-icon-video-pause",title:"暂停"},on:{click:function(a){t.handlePauseJob(e.row)}}}),t._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-more",title:"详情"},on:{click:function(a){t.handleViewJob(e.row)}}})]}}])})],1)],1)],1)],1)],1),t._v(" "),a("dialog-drag",{attrs:{visible:t.showQuartzDia,top:"8vh"},on:{"update:visible":function(e){t.showQuartzDia=e}}},[a("span",{attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"el-icon-edit margin-right-4"}),t._v(t._s(t.quartzEditReadonly?"任务详情":"任务编辑")+"\n    ")]),t._v(" "),a("quartz-mgr-edit",{attrs:{readonly:t.quartzEditReadonly,initData:t.editQuartz},on:{updataData:t.doUpdataQuartz,close:function(e){t.showQuartzDia=!1}}})],1)],1)},staticRenderFns:[]},g=a("VU/8")(y,x,!1,null,null,null);e.default=g.exports}});
//# sourceMappingURL=17.e7e4dbee60b7b789d5b0.js.map