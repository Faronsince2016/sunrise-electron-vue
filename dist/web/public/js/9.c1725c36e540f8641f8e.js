webpackJsonp([9],{IJfQ:function(e,t,r){"use strict";var a=r("JA1M");t.a={saveSysPerm:function(e){return a.a.post("/usrm/permMgr/saveSysPerm",e)},querySysPerm:function(e){return a.a.get("/usrm/permMgr/querySysPerm",{params:e})},delSysPerm:function(e){return a.a.delete("/usrm/permMgr/delSysPerm/"+e)},getPermMap:function(){return a.a.get("/usrm/permMgr/getPermMap")}}},lhVJ:function(e,t,r){"use strict";var a=r("JA1M");t.a={saveSysRole:function(e){return a.a.post("/usrm/roleMgr/saveSysRole",e)},querySysRole:function(e){return a.a.get("/usrm/roleMgr/querySysRole",{params:e})},delSysRole:function(e){return a.a.delete("/usrm/roleMgr/delSysRole/"+e)},getSelectPerm:function(e){return a.a.get("/usrm/roleMgr/getSelectPerm",{params:e})},getRoleByOrgUuid:function(e){return a.a.get("/usrm/roleMgr/getRoleByOrgUuid",{params:e})}}},q1p0:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("woOf"),o=r.n(a),n=r("Xxa5"),l=r.n(n),i=r("fZjL"),s=r.n(i),c=r("exGp"),u=r.n(c),d=r("lhVJ"),m=r("CWES"),p=r("IJfQ"),f={props:{data:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}},checkedKeys:{type:Array,default:function(){return[]}}},data:function(){return{filterText:"",isTreeExpand:!0,menuTreeProps:{children:"children",label:"menuName",key:"uuid",disabled:function(e){return"1"!==e.menuVisible}}}},watch:{checkedKeys:{handler:function(e){this.$emit("input",e)},immediate:!0},filterText:function(e){this.$refs.menuTree.filter(e)}},methods:{handleExpandSwitch:function(){this.isTreeExpand=!this.isTreeExpand,this.$utils.treeExpandSwitch(this.$refs.menuTree,this.isTreeExpand)},doCheckChange:function(){this.$emit("input",this.$refs.menuTree.getCheckedKeys())},doFilterNode:function(e,t){var r=t.menuName.includes(e),a=t.menuUrl.includes(e);return r||a},doRenderTreeContent:function(e,t){var r=t.node,a=t.data;t.store;return e("flex-container",{attrs:{wrap:"nowrap",alignItems:"center",justifyContent:"space-between"}},[e("flex-item",{attrs:{alignItems:"center"}},[e("span",{class:"margin-right-2"},[e("i",{class:a.menuIcon+(1==a.menuVisible?" icon-color-success":" icon-color-info")})]),e("el-tooltip",{attrs:{content:a.menuUrl,placement:"right",effect:1==a.menuOpenWay?"dark":"light"}},[e("span",{class:"icon-size-14"},[r.label])])])])}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("flex-container",{attrs:{direction:"column",wrap:"nowrap"}},[r("flex-container",[r("flex-item",{attrs:{grow:1}},[r("el-form",{staticClass:"form-style-line"},[r("el-form-item",[r("el-input",{attrs:{placeholder:"输入菜单名称或路径进行过滤",maxlength:"10","show-word-limit":""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1)],1)],1),e._v(" "),r("flex-item",{attrs:{alignItems:"center"}},[r("el-button",{attrs:{type:"pinforimary",size:"mini",plain:"",icon:e.isTreeExpand?"icon-ali ali-tuceng":"icon-ali ali-tuceng1",title:e.isTreeExpand?"全部折叠":"全部展开"},on:{click:e.handleExpandSwitch}})],1)],1),e._v(" "),r("flex-item",[r("el-tree",{ref:"menuTree",attrs:{"show-checkbox":"",data:e.data,"default-checked-keys":e.checkedKeys,"node-key":e.menuTreeProps.key,props:e.menuTreeProps,"default-expand-all":"",draggable:"","render-content":e.doRenderTreeContent,"filter-node-method":e.doFilterNode},on:{"check-change":e.doCheckChange}})],1)],1)},staticRenderFns:[]},g={components:{RoleMenu:r("VU/8")(f,h,!1,null,null,null).exports},props:{initData:{type:Object}},inject:["orgTree","orgTreeProps","permMap"],data:function(){return{loading:!1,selectedMenu:[],checkedKeys:[],formData:o()({},this.initData),formRules:{roleName:[{required:!0,message:"请输入角色名称 !",trigger:"change"}],roleCode:[{required:!0,message:"请输入角色编码 !",trigger:"change"}],orgUuid:[{required:!0,message:"请选择隶属组织 !",trigger:"change"}]}}},mounted:function(){this.initData.uuid&&this.initPermSelect(this.initData.uuid)},methods:{initPermSelect:function(e){var t=this;return u()(l.a.mark(function r(){var a;return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t.loading=!0,r.next=4,d.a.getSelectPerm({roleUuid:e});case 4:a=r.sent,s()(a.data).forEach(function(e){"1"===e&&(t.checkedKeys=a.data[e])}),r.next=10;break;case 8:r.prev=8,r.t0=r.catch(0);case 10:return r.prev=10,t.loading=!1,r.finish(10);case 13:case"end":return r.stop()}},r,t,[[0,8,10,13]])}))()},handleUpdateData:function(){var e=this;return u()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.editForm.validate();case 3:e.formData.permUuids={1:e.selectedMenu},e.$emit("updataData",e.formData),e.$emit("close"),t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}},t,e,[[0,8]])}))()}}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("flex-container",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[r("el-form",{ref:"editForm",staticClass:"form-style-line",attrs:{model:e.formData,rules:e.formRules,"label-position":"right","label-width":"90px"}},[r("el-row",[r("el-col",[r("el-form-item",{attrs:{label:"角色名称 :",prop:"roleName"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":""},model:{value:e.formData.roleName,callback:function(t){e.$set(e.formData,"roleName",t)},expression:"formData.roleName"}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"角色编码 :",prop:"roleCode"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":""},model:{value:e.formData.roleCode,callback:function(t){e.$set(e.formData,"roleCode",t)},expression:"formData.roleCode"}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"隶属组织 :",prop:"orgUuid"}},[r("el-cascader",{attrs:{options:e.orgTree,props:e.orgTreeProps,clearable:""},model:{value:e.formData.orgUuid,callback:function(t){e.$set(e.formData,"orgUuid",t)},expression:"formData.orgUuid"}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"角色描述 :",prop:"roleDesc"}},[r("el-input",{attrs:{type:"textarea",maxlength:"512","show-word-limit":""},model:{value:e.formData.roleDesc,callback:function(t){e.$set(e.formData,"roleDesc",t)},expression:"formData.roleDesc"}})],1)],1),e._v(" "),e.formData.createdUser?[r("el-col",[r("el-form-item",{attrs:{label:"创建用户 :",prop:"createdUser"}},[r("el-input",{attrs:{disabled:""},model:{value:e.formData.createdUser,callback:function(t){e.$set(e.formData,"createdUser",t)},expression:"formData.createdUser"}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"创建时间 :",prop:"createdTime"}},[r("el-input",{attrs:{value:e.$utils.toDateString(e.formData.createdTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"更新用户 :",prop:"updatedUser"}},[r("el-input",{attrs:{disabled:""},model:{value:e.formData.updatedUser,callback:function(t){e.$set(e.formData,"updatedUser",t)},expression:"formData.updatedUser"}})],1)],1),e._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"更新时间 :",prop:"updatedTime"}},[r("el-input",{attrs:{value:e.$utils.toDateString(e.formData.updatedTime,"yyyy-MM-dd HH:mm:ss"),disabled:""}})],1)],1)]:e._e()],2)],1),e._v(" "),r("flex-container",{staticClass:"padding-10"},[r("flex-item",{attrs:{width:"100%"}},[r("el-tabs",e._l(e.permMap,function(t){return r("el-tab-pane",{key:t.key,attrs:{label:t.label}},["1"===t.key?r("role-menu",{attrs:{data:t.data,checkedKeys:e.checkedKeys},model:{value:e.selectedMenu,callback:function(t){e.selectedMenu=t},expression:"selectedMenu"}}):e._e()],1)}))],1)],1),e._v(" "),r("flex-container",{staticClass:"footer",attrs:{justifyContent:"flex-end"}},[r("el-button",{on:{click:function(t){e.$emit("close")}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleUpdateData}},[e._v("确 定")])],1)],1)},staticRenderFns:[]},b={uuid:null,orgUuid:"",roleCode:"",roleName:"",roleDesc:"",createdUser:"",createdTime:"",updatedUser:"",updatedTime:"",permUuids:null},y={components:{RoleMgrEdit:r("VU/8")(g,v,!1,null,null,null).exports},provide:function(){return{orgTree:this.orgTree,orgTreeProps:this.orgTreeProps,permMap:this.permMap}},data:function(){return{permMap:[],orgTree:[],orgTreeProps:{checkStrictly:!0,emitPath:!1,value:"uuid",label:"orgName"},orgViewProps:{checkStrictly:!0,emitPath:!1,value:"uuid",label:"orgName"},showRoleDia:!1,roleForm:{orgUuid:"",roleCode:"",roleName:""},pageOptions:{pagerCount:5},editRole:{}}},mounted:function(){this.initOrgTree(),this.initPermMap()},methods:{initPermMap:function(){var e=this;return u()(l.a.mark(function t(){var r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getPermMap();case 2:r=t.sent,e.$utils.clear(e.permMap),s()(r.data).forEach(function(t){var a=void 0;"1"===t&&(a=e.$utils.toArrayTree(r.data[t],{key:"menuUrl",parentKey:"menuParent",children:"children",sortKey:"menuOrde"})),e.permMap.push({key:t,label:"菜单资源",data:a})});case 5:case"end":return t.stop()}},t,e)}))()},initOrgTree:function(){var e=this;return u()(l.a.mark(function t(){var r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m.a.getOrgTree();case 3:r=t.sent,e.$utils.eachTree(r.data,function(e){0===e.children.length&&delete e.children}),e.$utils.clear(e.orgTree),r.data.forEach(function(t){return e.orgTree.push(t)}),t.next=11;break;case 9:t.prev=9,t.t0=t.catch(0);case 11:case"end":return t.stop()}},t,e,[[0,9]])}))()},loadRole:function(e){return d.a.querySysRole(e)},handleQueryRole:function(){this.$refs.roleTable.loadData(this.roleForm)},handleEditRole:function(e){this.editRole=o()({},e),this.showRoleDia=!0},handleAddRole:function(){this.editRole=o()({},b),this.showRoleDia=!0},handleDelRole:function(e){var t=this;return u()(l.a.mark(function r(){return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d.a.delSysRole([e.uuid]);case 3:return r.prev=3,t.handleQueryRole(),r.finish(3);case 6:case"end":return r.stop()}},r,t,[[0,,3,6]])}))()},doUpdataRole:function(e){var t=this;return u()(l.a.mark(function r(){return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d.a.saveSysRole(e);case 3:return r.prev=3,t.handleQueryRole(),r.finish(3);case 6:case"end":return r.stop()}},r,t,[[0,,3,6]])}))()}}},x={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("flex-container",{attrs:{wrap:"nowrap",justifyContent:"space-between"}},[r("flex-item",{attrs:{grow:1,width:"100%"}},[r("el-card",[r("flex-container",{attrs:{slot:"header",justifyContent:"space-between"},slot:"header"},[r("flex-item",{attrs:{alignItems:"center"}},[r("i",{staticClass:"el-icon-user margin-right-6 font-size-16"}),e._v("角色管理\n        ")]),e._v(" "),r("flex-item",{attrs:{alignItems:"center"}},[r("el-button",{attrs:{type:"primary",size:"mini",circle:"",icon:"el-icon-plus",title:"添加"},on:{click:e.handleAddRole}}),e._v(" "),r("el-button",{attrs:{type:"primary",size:"mini",circle:"",icon:"el-icon-search",title:"查询"},on:{click:e.handleQueryRole}}),e._v(" "),r("el-button",{attrs:{size:"mini",circle:"",plain:"",icon:"el-icon-refresh-left",title:"重置"},on:{click:function(t){e.$refs.roleForm.resetFields()}}})],1)],1),e._v(" "),r("flex-container",{attrs:{direction:"column",wrap:"nowrap"}},[r("flex-item",{staticClass:"margin-bottom-10"},[r("el-form",{ref:"roleForm",staticClass:"form-style-line",attrs:{model:e.roleForm,"label-position":"right","label-width":"90px"}},[r("el-row",[r("col-pr",[r("el-form-item",{attrs:{label:"隶属组织 :",prop:"orgUuid"}},[r("el-cascader",{attrs:{options:e.orgTree,props:e.orgTreeProps,clearable:""},model:{value:e.roleForm.orgUuid,callback:function(t){e.$set(e.roleForm,"orgUuid",t)},expression:"roleForm.orgUuid"}})],1)],1),e._v(" "),r("col-pr",[r("el-form-item",{attrs:{label:"角色编码 :",prop:"roleCode"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.roleForm.roleCode,callback:function(t){e.$set(e.roleForm,"roleCode",t)},expression:"roleForm.roleCode"}})],1)],1),e._v(" "),r("col-pr",[r("el-form-item",{attrs:{label:"角色名称 :",prop:"roleName"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1)],1)],1)],1)],1),e._v(" "),r("flex-item",[r("data-table",{ref:"roleTable",attrs:{border:"",index:"","auto-load":"","highlight-current-row":"","auto-update":"","column-button":"","csv-button":"",title:"Data Table","load-data-func":e.loadRole,pageOptions:e.pageOptions}},[r("data-table-column",{attrs:{prop:"roleName",label:"角色名称","show-overflow-tooltip":""}}),e._v(" "),r("data-table-column",{attrs:{prop:"roleCode",label:"角色编码","show-overflow-tooltip":""}}),e._v(" "),r("data-table-column",{attrs:{prop:"orgUuid",label:"隶属组织","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-cascader",{staticClass:"cascader-table-disabled",attrs:{options:e.orgTree,value:t.row.orgUuid,props:e.orgViewProps,disabled:""}})]}}])}),e._v(" "),r("data-table-column",{attrs:{prop:"roleDesc",label:"角色描述","show-overflow-tooltip":""}}),e._v(" "),r("data-table-column",{attrs:{prop:"op",label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit",title:"编辑"},on:{click:function(r){e.handleEditRole(t.row)}}}),e._v(" "),r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(r){e.handleDelRole(t.row)}}})]}}])})],1)],1)],1)],1)],1),e._v(" "),r("dialog-drag",{attrs:{title:"角色编辑",visible:e.showRoleDia,top:"8vh"},on:{"update:visible":function(t){e.showRoleDia=t}}},[r("span",{attrs:{slot:"title"},slot:"title"},[r("i",{staticClass:"el-icon-edit margin-right-4"}),e._v("角色编辑\n    ")]),e._v(" "),r("role-mgr-edit",{attrs:{initData:e.editRole},on:{updataData:e.doUpdataRole,close:function(t){e.showRoleDia=!1}}})],1)],1)},staticRenderFns:[]},w=r("VU/8")(y,x,!1,null,null,null);t.default=w.exports}});
//# sourceMappingURL=9.c1725c36e540f8641f8e.js.map